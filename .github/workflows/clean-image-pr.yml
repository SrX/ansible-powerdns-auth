name: Cleanup PR Images

on:
  pull_request:
    types:
    - closed
    branches:
    - main

jobs:
  clean-image:
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        pdns: [4.4, 4.5, 4.6, master]
    steps:
    - name: delete image tag
      run: 'curl -s -X DELETE -H "Authorization: Bearer ${{ secrets.QUAY_API_TOKEN }}" https://quay.io/api/v1/repository/km6g-ci-images/ansible-powerdns-auth/tag/pdns-${{ matrix.pdns }}-pr${{ github.event.pull_request.number }}'
